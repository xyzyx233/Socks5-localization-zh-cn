Network Working Group                                           M. Leech
Request for Comments: 1928                    Bell-Northern Research Ltd
Category: Standards Track                                       

                                         						M. Ganis
                                         International Business Machines
                                                                  Y. Lee
                                                  NEC Systems Laboratory
                                                                R. Kuris
                                                       Unify Corporation
                                                               D. Koblas
                                                  Independent Consultant
                                                                L. Jones
                                                 Hewlett-Packard Company
                                                              March 1996
SOCKS 协议 版本5

#报告书状态

这个文档为因特网交流规定了一个标准因特网传输协议，并且希望为了提高给予讨论与建议。请参照当前版本的“Internet Official Protocol Standards” 对照标准化状态和这个协议的状态。这个文档的传播是不受限的。

# 确认

这个文档叙述了一个对前一版协议的改进[1]。这个新的协议的主体来自活跃的讨论和原型的使用。主要贡献者有：Marcus Leech: Bell-Northern Research, David Koblas: Independent Consultant, Ying-Da Lee: NEC Systems Laboratory, LaMont Jones: Hewlett-Packard Company, Ron Kuris: Unify Corporation, Matt Ganis: International Business Machines。

# 1. 介绍

防火墙可以有效的将一个组织的因特网结构与外部网络隔绝开。防火墙的使用像因特网一样越来越流行。这些防火墙系统通常作为网络间的应用层网关，提供对TELNET，FTP，和SMTP的控制权限。随着更加复杂的应用层协议被设计出来用更方便发现全球信息，就急需一个提供一个通用框架让这些协议能够透明安全的穿越防火墙。有这样一个对于强认证的需求，这样细致的传输行为是客观存在的。这样的需求将客户端—服务器的关系暴露在不同的网络组织之间。并且这样的关系需要被控制并且总是强认证。这里叙述的协议被设计用来提供一个框架，这个框架用于应用于和UDP范畴中的客户端—服务器应用程序使得应用程序之间能够安全可信赖地使用网络防火墙服务。这个协议理论上做为应用层和传输层之间的衔接层。这一层并不能提供网络层网关服务，比如转发ICMP报文。

#2. 现实状况
现在已经有了一个SOCKS第4版协议模型，这个协议为基于TCP的客户端—服务器应用程序，提供了一个不安全的通过防火墙的传输。这些应用程序包括TELNET、FTP和常见的信息发现协议，如HTTP、WAIS和GOPHER。
这个模型包括UDP并且拓展了框架为了包括一个普遍的强认证方案，还增加了编址方案用来包含域名和IPV6地址。
这个协议的使用往往需要重编译或重链接基于TCP的客户端程序，这样才能使用SOCKS库中的合适放入封装程序。
补充：

除非有另外说明，以分组格式出现的十进制数字表示相应字段的长度，以八位字节表示。在给定的八位字节必须有特定值的情况下，语法X'hh'用于表示该字段中单个八位字节的值。当“变量”这个词被使用时，它表示相应的字段具有由关联的（一个或两个字节）长度字段或数据类型字段定义的可变长度。

# 3. 基于TCP客户端的过程

当一个基于TCP的客户端希望与一个只能通过防火墙（这种决定留给实现）到达的对象建立连接时，它必须打开一个连接到SOCKS服务系统上相应的SOCKS端口的TCP连接。SOCKS服务通常情况下位于TCP连接的1080端口上。客户端开始协商要使用的认证方式，使用选定的认证方式进行认证，然后发送一个回复请求。SOCKS服务器评定请求，并且决定是建立连接相应的连接或拒绝它。

除非有另外说明，以分组格式出现的十进制数字表示相应字段的长度，以八位字节表示。在给定的八位字节必须有特定值的情况下，语法X'hh'用于表示该字段中单个八位字节的值。当“变量”这个词被使用时，它表示相应的字段具有由关联的（一个或两个字节）长度字段或数据类型字段定义的可变长度。

客户端连接到服务器并且发送一个版本标识符/方法选择信息：

| VER  | NMETHODS | METHODS  |
| :--: | :------: | :------: |
|  1   |    1     | 1 to 255 |

对于这个版本的协议VER字段被设置为X'05'，NMETHODS字段包含了在METHODS字段中方法标识符八位字节的长度。

服务器从METHODS字段中给出的方法中选择一个方法并且发送一个METHOD选择信息。

| VER  | METHOD |
| :--: | :----: |
|  1   |   1    |

如果别选择的方法是X'FF'，客户端列出的方法没有一个能够被服务器接受，并且客户端必须关闭连接。

当然可以别用来定义METHODS的有：

* X'00' 不需要请求授权
* X'01' 通用安全服务应用程序接口
* X'02'  用户名/密码
* X'03' 到 X'7F' 互联网号码分配局已分配
* X'80' 到 X'FE' 为私有方法保留
* X'FF' 不可接受的方法

客户端和服务器之后进入了一个方法相关的子协议。方法相关的子协议的描述在其他的文档中。都与支持这个协议的新的METHOD的开发者应该联系INNA获取METHOD号。这个号码分配文档一个被引用于当前列出的方法号和它们的相关文档中。

合理的实现方法应该支持通用安全服务应用程序接口也应该支持用户名/密码认证方式。

# 4. 请求

一旦方法相关的子协议完成，客户端发送请求的细节。如果协商的方法包括用于检查完整性和/或机密性的封装，这些请求必须被封装在依赖于方法的封装中。

SOCKS请求按以下形式组成：

| VER  | CMD  |  RSV  | ATYP | DST.ADDR | DST.PORT |
| :--: | :--: | :---: | :--: | :------: | :------: |
|  1   |  1   | X'00' |  1   | Variable |    2     |

其中：

* VER 协议版本 X'05'
* CMD
  * 连接 X'01'
  * 绑定 X'02'
  * UDP相关 X‘03’
* ATYP
  * IPV4地址 X'01'
  * 域 X'03'
  * IPV6地址 X'04'
* DST.ADDR 需要目的地地址
* DST.PORT 八位字节的网络中所需的目标端口

SOCKS服务器通常会根据源地址和目标地址评估请求，并根据请求类型返回一个或多个回复消息。

# 5. 地址

在地址字段中(DST.ADDR,BND.ADDR)，ATYP字段特定类型的地址包含在以下字段。

  * X'01'

地址是IPV4地址，长度为4个八位字节

* X'03'

地址字段包含完全限定的域名。 地址字段的第一个八位字节包含后面的八位字节数，没有终止的NUL八位字节。

* X'04'

地址是一个IPV6地址，长度为16个八位字节

# 6. 回复



# 7. 基于UDP客户端的过程



# 8. 安全考虑

这个文档描述了一个IP网络防火墙的应用层穿越协议。这样穿越协议的安全性很大程度上基于特定的认证和封装方法提供在特定的实现方法，这个方法在SOCKS客户端和服务器之间协商来确定。

# 9. 参考

[1] Koblas, D., "SOCKS", Proceedings: 1992 Usenix Security Symposium.

作者地址：

       Marcus Leech
       Bell-Northern Research Ltd
       P.O. Box 3511, Stn. C,
       Ottawa, ON
       CANADA K1Y 4H7
    
       Phone: (613) 763-9145
       EMail: mleech@bnr.ca